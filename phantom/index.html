<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phantom Wallet Integration</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body>
    <button id="connectButton">Connect to Phantom Wallet</button>
    <button id="sendButton">Send SOL</button>
    <button id="disconnectButton">Disconnect</button>
    <script>
        let provider;
        let mainAddress;
        let connection;

        // Check if Phantom is installed
        if (window.solana && window.solana.isPhantom) {
            document.getElementById('connectButton').addEventListener('click', async () => {
                try {
                    const response = await window.solana.connect();
                    console.log("Connected with Public Key:", response.publicKey.toString());
                    mainAddress = response.publicKey.toString();
                    await getSolBalance();
                    await getSplTokenBalance('5Jozez85huvwbjkNxuQZpJvK8mydZAXtpbZ8RBY6or5');
                } catch (error) {
                    console.error(error);
                }
            });

            document.getElementById('disconnectButton').addEventListener('click', async () => {
                try {
                    await window.solana.disconnect();
                    console.log('Disconnected from Phantom Wallet');
                } catch (error) {
                    console.error('Failed to disconnect:', error);
                }
            });

            document.getElementById('sendButton').addEventListener('click', async () => {
                await sendTransaction();
            });
        } else {
            console.log("Phantom Wallet not detected. Please install it.");
        }

        async function getSolBalance() {
            connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
            const balance = await connection.getBalance(new solanaWeb3.PublicKey(mainAddress));
            console.log("SOL Balance:", balance / solanaWeb3.LAMPORTS_PER_SOL, "SOL");
        }

        async function getSplTokenBalance(mintAddress) {
            const mintPublicKey = new solanaWeb3.PublicKey(mintAddress);
            const tokenAccounts = await connection.getParsedTokenAccountsByOwner(window.solana.publicKey, { mint: mintPublicKey });

            if (tokenAccounts.value.length > 0) {
                const accountInfo = tokenAccounts.value[0].account.data.parsed.info;
                const tokenBalance = accountInfo.tokenAmount.uiAmount;
                console.log("SPL Token Balance:", tokenBalance);
            } else {
                console.log("This wallet does not have the specified SPL token.");
            }
        }

        async function sendTransaction() {
            if (!provider) {
                provider = window.solana;
            }

            const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
            const recipientPublicKey = new solanaWeb3.PublicKey('3XZwt8wCPJ5UeGvvBJyj3hYE5pRzZ9wADgtb4PBCd6Uu'); // Replace with the recipient's public key
            const senderPublicKey = provider.publicKey;

            const transaction = new solanaWeb3.Transaction().add(
                solanaWeb3.SystemProgram.transfer({
                    fromPubkey: senderPublicKey,
                    toPubkey: recipientPublicKey,
                    lamports: solanaWeb3.LAMPORTS_PER_SOL * 0.1, // Amount to send (0.1 SOL in this example)
                })
            );

            try {
                const { signature } = await provider.signAndSendTransaction(transaction);
                await connection.confirmTransaction(signature);
                console.log("Transaction confirmed with signature:", signature);
            } catch (error) {
                console.error("Failed to send transaction:", error);
            }
        }
    </script>
</body>
</html>
